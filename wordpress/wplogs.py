import asyncio
from datetime import datetime


class WPLogs(object):
    _LOG_FILE_PATH = "log.txt"
    instance = None

    class __WPLogs:

        file_lock = asyncio.Lock()

        def __init__(self, file_path):
            self.logfile = file_path

    def __init__(self, file_path=_LOG_FILE_PATH):
        if not WPLogs.instance:
            WPLogs.instance = WPLogs.__WPLogs(file_path)
        else:
            WPLogs.instance.logfile = file_path

    async def save_log(self, log):
        await self.instance.lockfile.acquire()
        try:
            with open(self.instance.logfile, "a+") as file:
                now = datetime.now()
                current_time = now.strftime("%H:%M:%S")
                file.write(current_time+": ")
                file.write(log)
                file.write("\n")
        except:
            print("Error while printing to logs file.")
        finally:
            self.instance.lockfile.release()
