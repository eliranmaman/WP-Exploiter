import pytest

from wordpress import WPDatabaseResetExploiter
from tests.test_data import protocols, params

params[2] = ("elro-sec.com/dev2", False)
params[3] = ("elro-sec.com/dev3", False)

login_data = {
    "username": "elro_26",
    "password": "123456",
    "action": "login"
}

@pytest.mark.parametrize("url, result", params)
def test_database_exploiter_is_vulnerable(url, result):
    for protocol in protocols:
        target = "{}{}".format(protocol, url)
        exploiter = WPDatabaseResetExploiter(target)
        is_vulnerable = exploiter.is_vulnerable()
        assert type(is_vulnerable) is bool
        assert is_vulnerable == result


@pytest.mark.parametrize("url, result", params)
def test_database_exploiter_exploite_via_register_no_data(url, result):
    for protocol in protocols:
        target = "{}{}".format(protocol, url)
        exploiter = WPDatabaseResetExploiter(target)
        is_success = exploiter.exploit()
        assert type(is_success) is bool
        assert is_success == result


@pytest.mark.parametrize("url, result", params)
def test_database_exploiter_exploite_via_login(url, result):
    for protocol in protocols:
        data = login_data
        target = "{}{}".format(protocol, url)
        login_data['login_page'] = "{}/wp-login.php".format(target.strip('/'))
        exploiter = WPDatabaseResetExploiter(target)
        is_success = exploiter.exploit()
        assert type(is_success) is bool
        assert is_success == result
