import pytest

from wordpress import WPDetector
from tests.test_data import protocols, params

detector = WPDetector(None)


@pytest.mark.parametrize("url, result", params)
def test_detection(url, result):
    for protocol in protocols:
        target = "{}{}".format(protocol, url)
        detect = detector.detect(target, sensitivity=0.6)
        assert type(detect) is bool
        if "he.wordpress" in target:
            assert detect is True
        else:
            assert detect is result


@pytest.mark.parametrize("url, result",
                         [
                             ("elro-sec.com/dev1/", "5.4"),
                             ("elro-sec.com/dev2/", "4.9.13"),
                             ("elro-sec.com/dev3/", "5.0.8"),
                             ("he.wordpress.com", "Unknown"),
                             ("google.co.il", "Unknown"),
                             ("google.com", "Unknown"),
                             ("en.wikipedia.org/wiki/WordPress", "Unknown"),
                             ("ynet.co.il", "Unknown"),
                             ("ostraining.com/blog/wordpress/site-built-in-wordpress", "Unknown"),
                             ("lllllllllllllllllllllllllllllllllllllllllllllllllllllllllll.com", "Unknown"),
                             ("fsklfhoashfsdlkhmsclfhsdmlkak.com", "Unknown"),
                             ("aacyencuigfcliusfsgnusdgnfsynfwncgckdsygnldcf.co.il", "Unknown"),
                             ("ftp://eliranm.co", "Unknown"),
                             ("eliran url maman", "Unknown"),
                             ("אתר בעברית ?", "Unknown"),
                             ("ftp://adsadsas", "Unknown")
                         ])
def test_detection(url, result):
    for protocol in protocols:
        target = "{}{}".format(protocol, url)
        version = detector.get_version(target)
        assert type(version) is str
        assert version == result
